# QPay Client

## Как использовать

### Шаг 0: Подготовка окружения
0.1. Установите esptools:
```sh
pip install esptool
```

0.2. Установите поддержку плат ESP32 от Espressif в Arduino IDE:
1. Откройте Arduino IDE.
2. Перейдите в **Файл** -> **Настройки**.
3. В поле **Additional Board Manager URLs** добавьте следующий URL:
   ```
   https://dl.espressif.com/dl/package_esp32_index.json
   ```
4. Перейдите в **Инструменты** -> **Плата** -> **Диспетчер плат**.
5. Найдите **esp32** и установите пакет от Espressif Systems.

### Шаг 1: Перемещение библиотек
Переместите папку `libraries` в `~/Documents/Arduino/`:
```sh
mv libraries ~/Documents/Arduino/
```

### Шаг 2: Открытие проекта в Arduino IDE
Откройте файл `./main/main.ino` с помощью Arduino IDE.

### Шаг 3: Настройка платы и порта
1. В Arduino IDE выберите плату **DOIT ESP32 DEVKIT V1**.
2. Выберите порт, к которому подключено ваше устройство (обычно это COM-порт на Windows или /dev/ttyUSB0 на Linux).

### Шаг 4: Настройка конфигурации
Перейдите в файл `./main/config.cpp` и проверьте настройки:
- SSID и пароль Wi-Fi
- APN для мобильной сети
- Токен устройства
- Пины для подключенных устройств

### Шаг 5: Загрузка и запуск
1. Подключите ваше устройство ESP32 к компьютеру.
2. Нажмите кнопку **Загрузить** (Upload) в Arduino IDE.
3. После завершения загрузки, устройство автоматически перезагрузится и начнет выполнение программы.

## Описание файлов

- `main.ino`: Основной файл проекта.
- `config.h` и `config.cpp`: Файлы с конфигурацией (настройки Wi-Fi, мобильной сети, пины и т.д.).
- `acceptors.h` и `acceptors.cpp`: Логика обработки сигналов от монетоприемника и купюроприемника.
- `net.h` и `net.cpp`: Логика подключения к сети (Wi-Fi/GSM).
- `socket.h` и `socket.cpp`: Логика работы с вебсокетами.

## Основной процесс работы

1. Подключение к Wi-Fi или GSM.
2. Аутентификация через вебсокеты с использованием токена устройства.
3. Подписка на события через вебсокеты.
4. Обработка сигналов от монетоприемника и купюроприемника.
5. Выполнение соответствующих действий при получении команд через вебсокеты (проверка транзакций, подтверждение платежей и т.д.).

Следуйте этим инструкциям для успешной настройки и запуска проекта QPay Client на вашем устройстве ESP32.